function encodeStr(a){var e="";return a.forEach(a=>{e+=btoa(encodeURIComponent(a))}),(ks=[])[0]="Y",ks[1]="M",ks[2]="=",ks[3]="A",ks[4]="N",ks.forEach(a=>{e=e.replaceAll(a,"/"+btoa(a+"_apee"))}),btoa(encodeURIComponent(e))}function createWork(){var a=$("#input-url").val(),e=$("#input-password").val(),t=$("#input-desc").val(),s=$("#input-day").val()||0,n=$("#input-end").val();try{new URL(a)}catch{return void $("#input-url").addClass("is-invalid").focus()}if(-1==e.search(/^\w{0,20}$/))$("#input-password").addClass("is-invalid").focus();else if(200<t.length)$("#input-desc").addClass("is-invalid").focus();else if(s<0||1e4<s)$("#input-day").addClass("is-invalid").focus();else{if(n&&-1==n.search(/^\w{6,20}$/))return console.log(e.search(/^\w{0,20}$/)),void $("#input-end").addClass("is-invalid").focus();$(".page-home .btns .createWork").attr("disabled","disabled").html("正在生成中...");var o=[],d=(o.push(a),o.push(e),o.push(s),(new Date).getTime()),o=(o.push(d),encodeStr(o));$.post("api/add_url.php",{a:a,b:e,c:t,d:s,e:d,f:o,g:n},function(a){if($(".page-home .btns .createWork").removeAttr("disabled","disabled").html("生成链接"),200==a.code){clearForm(),Poncon.load.result=!0,location.hash="/result";for(var e=["短链接","分享链接","原链接","密码","有效期","描述"],t=[`<a class="short-url" href="${location.origin}/${a.data.end}${a.data.password?"/"+a.data.password:""}" target="_blank">${location.origin}/${a.data.end}${a.data.password?"/"+a.data.password:""}</a>`,`<a href="#/${a.data.end}" target="_blank" class="text-danger">${location.origin}/#/${a.data.end}</a>`,""+a.data.url,""+a.data.password,0==a.data.guoqi?"永久有效":"剩余 "+a.data.guoqi+" 天",""+$(a.data.desc).text()],s=0,n="";s<e.length;s++)t[s]&&(n+=`<div class="mb-2 text-truncate"><b>${e[s]}：</b>${t[s]}</div>`);$(".page-result .line-list").html(n)}else alert(a.msg)})}}function clearForm(){$(".page-home input").val("").removeClass("is-invalid")}var Poncon={data:{},load:{}};history.scrollRestoration="manual",$(document).ready(function(){function e(a){a=(a=a.split("/"))[1];a&&a.match(/^\w+$/)||(a="home"),$(".page-oyp").css("display","none"),$(".page-"+a).css("display","block"),"home"==a?history.replaceState({},null,"./"):"result"==a&&Poncon.load.result||(location.hash="")}new ClipboardJS(".copybtn"),e(location.hash),document.body.ondragstart=()=>!1,window.addEventListener("hashchange",function(a){e(new URL(a.newURL).hash)}),$("input").bind("keyup",function(){$(this).removeClass("is-invalid")})});