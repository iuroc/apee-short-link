function encodeStr(a){var s="";return a.forEach(a=>{s+=btoa(encodeURIComponent(a))}),(ks=[])[0]="Y",ks[1]="M",ks[2]="=",ks[3]="A",ks[4]="N",ks.forEach(a=>{s=s.replaceAll(a,"/"+btoa(a+"_apee"))}),btoa(encodeURIComponent(s))}function createWork(){var a=$("#input-url").val(),s=$("#input-password").val(),e=$("#input-desc").val(),o=$("#input-day").val()||0,t=$("#input-end").val();try{new URL(a)}catch(a){return void $("#input-url").addClass("is-invalid").focus()}if(-1==s.search(/^\w{0,20}$/))$("#input-password").addClass("is-invalid").focus();else if(200<e.length)$("#input-desc").addClass("is-invalid").focus();else if(o<0||1e4<o)$("#input-day").addClass("is-invalid").focus();else{if(t&&-1==t.search(/^\w{6,20}$/))return console.log(s.search(/^\w{0,20}$/)),void $("#input-end").addClass("is-invalid").focus();$(".page-home .btns .createWork").attr("disabled","disabled").html("正在生成中...");var n=[],i=(n.push(a),n.push(s),n.push(o),(new Date).getTime()),n=(n.push(i),encodeStr(n));$.post("api/add_url.php",{a:a,b:s,c:e,d:o,e:i,f:n,g:t},function(a){var s;if($(".page-home .btns .createWork").removeAttr("disabled","disabled").html("生成链接"),200==a.code)return clearForm(),Poncon.load.result=!0,location.hash="/result",s=makeHtml(a),void $(".page-result .line-list").html(s);alert(a.msg)})}}function makeHtml(a){for(var s=["短链接","分享链接","原链接","密码","有效期","描述"],e=[`<a class="short-url" href="${location.origin}/${a.data.end}${a.data.password?"/"+a.data.password:""}" target="_blank">${location.origin}/${a.data.end}${a.data.password?"/"+a.data.password:""}</a>`,`<a href="/s/${a.data.end}" target="_blank" class="text-danger">${location.origin}/s/${a.data.end}</a>`,""+a.data.url,""+a.data.password,0==a.data.guoqi?"永久有效":"剩余 "+a.data.guoqi+" 天",""+$(a.data.desc).text()],o=0,t="";o<s.length;o++)e[o]&&(t+=`<div class="mb-2 text-truncate"><b>${s[o]}：</b>${e[o]}</div>`);return t}function clearForm(){$(".page-home input").val("").removeClass("is-invalid")}function share_load(a,s,e){$.get("api/go_url.php",{end:a,type:"json",password:s},function(a){var s;if(200==a.code)return s=makeHtml(a),$(".page-share .show-password").show(),$(".page-share .show-nopassword").hide(),void $(".page-share .line-list").html(s);901==a.code?"click"==e?$(".page-share .show-nopassword .input-group").addClass("is-invalid"):($(".page-share .show-nopassword").show(),$(".page-share .show-password").hide()):location.hash=""})}function share_submitPassword(){var a=$(".page-share .input-password").val(),s=location.hash.split("/")[2];history.replaceState({},null,"#/share/"+s+"/"+a),share_load(s,a,"click")}var Poncon={data:{},load:{}};history.scrollRestoration="manual",$(document).ready(function(){function s(a){var s=(a=a.split("/"))[1];s&&s.match(/^\w+$/)||(s="home"),$(".page-oyp").css("display","none"),$(".page-"+s).css("display","block"),"home"==s?history.replaceState({},null,"./"):"result"==s?Poncon.load.result||(location.hash=""):"share"==s?share_load(a[2],a[3]):location.hash=""}new ClipboardJS(".copybtn"),s(location.hash),document.body.ondragstart=()=>!1,window.addEventListener("hashchange",function(a){s(new URL(a.newURL).hash)}),$("input").bind("keyup",function(){$(this).removeClass("is-invalid"),$(this).parent().removeClass("is-invalid")})});